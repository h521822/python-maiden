2020-01-13 22:50:26.637 DEBUG 16444 --- [nio-8080-exec-5] n.q.p.w.f.m.F.listFutTransaction         : ==>  Preparing: SELECT * FROM ( SELECT TMP.*, ROWNUM ROW_ID FROM ( select * from ( with temp AS( SELECT FUT_TRANSACTION.IS_CONFIRM_FLAG, FUT_TRANSACTION.NOTIFIER, NOTIFIER_STAFF.STAFF_NAME AS notifierName, FUT_TRANSACTION.APPROVAL_STATUS, DD_APPROVAL_BUSINESS.APPROVAL_GROUP || APPROVAL_STATUS_DICT.DICT_ITEM_NAME AS approvalStatusName, FUT_TRANSACTION.CATEGORY, CATEGORY_DICT.DICT_ITEM_NAME AS CATEGORY_NAME, FUT_TRANSACTION. CHECK_STATUS, FUT_TRANSACTION. CHECK_STAFF, CHECK_STATUS_DICT.DICT_ITEM_NAME AS checkStatusName, FUT_TRANSACTION. FUT_TRANSACTION_ID, ATTACHMENT.ID AS ATTACHMENT_ID, FUT_SETTLE.BILLING_DOCUMENT_PATH, FUT_TRANSACTION. PROCEDURE_FEE_AMT, FUT_TRANSACTION. isBegin, BEGIN_DICT.DICT_ITEM_NAME AS isBeginName, FUT_TRANSACTION. ID, FUT_TRANSACTION.HEADER_ID, FUT_TRANSACTION.TRANSACTION_TYPE, TRANSACTION_TYPE_DICT.DICT_ITEM_NAME AS transactionTypeName, FUT_TRANSACTION.BROKER_ID
, FUT_TRANSACTION.TRADING_ACCOUNT_ID, FUT_TRANSACTION.MARKET_ID, FUT_TRANSACTION.FUTURES_VARIETY_ID, FUT_TRANSACTION.FUTURES_CONTRACT, FUT_TRANSACTION.DEAL_DATE, /*成交日期*/ TO_CHAR(FUT_TRANSACTION.DEAL_DATE,'YYYY-MM-DD') AS dealDateString, FUT_TRANSACTION.FUTURES_DIRECTION, OPTION_DIRECTION_DICT.DICT_ITEM_NAME AS futuresDirectionName, FUT_TRANSACTION.FUTURES_POSITIONS, FUTURES_POSITIONS_DICT.DICT_ITEM_NAME AS futuresPositionsName, FUT_TRANSACTION.STRIKE_PRI, FUT_TRANSACTION.CURRENCY, FUT_TRANSACTION.STRIKE_LOT, FUT_TRANSACTION.STRIKE_WEIGHT, FUT_TRANSACTION.UNIT, FUT_TRANSACTION.USED_STRIKE_LOTS, FUT_TRANSACTION.AVAILABLE_STRIKE_LOTS, FUT_TRANSACTION.CATEGORY_ID, FUT_TRANSACTION.STRIKE_NO, FUT_TRANSACTION.BILLING_ID, /*更正状态*/ FUT_TRANSACTION.STATUS, STATUS_DICT.DICT_ITEM_NAME as statusName, FUT_TRANSACTION.REMARK, FUT_TRANSACTION.DELETE_FLAG, FUT_TRANSACTION.VERSION_NUM, FUT_TRANSACTION.CREATE_USER, FUT_TRANSACTION.CREATE_DATE, FUT_TRANSACTION.UPDATE_USER, FUT_TRANSACTION.UPDATE_DATE, FU
T_TRANSACTION.LIABLE_MAN, NVL ( FUT_TRANSACTION.QUANTITY,0) AS quantity, /*关联ID*/ FUT_TRANSACTION.TRANSACTION_ID, SYS_ORGAN.ORGAN_NAME, DD_FCOMPANY.FCOMPANY_ALL_NAME, DD_ACCOUNT.USER_ACCOUNT AS FUTRE_ACCOUNT, FPRODUCT_NAME.FPRODUCT_NAME, /*FUT_CATEGORY.CATEGORY_NAME,*/ DD_MARKET.EXCHANGE_CODE AS MARKET_NAME , FUT_TRANSACTION_CORRECT.STRIKE_NO AS correctStrikeNo , /*合同号*/ LISTAGG ( t.CONTRACT_NO, ',' ) WITHIN GROUP ( ORDER BY t.CONTRACT_NO ) AS contractNo FROM /*WB_TBL_FUT_TRANSACTION FUT_TRANSACTION*/ ( SELECT ? AS isBegin, FPRODUCT_NAME.ID AS varietyId, t1.* FROM WB_TBL_FUT_TRANSACTION t1 LEFT OUTER JOIN ST_TBL_DD_FPRODUCT DD_FPRODUCT ON DD_FPRODUCT.ID = t1.FUTURES_VARIETY_ID LEFT JOIN ST_TBL_DD_FPRODUCT_NAME FPRODUCT_NAME ON FPRODUCT_NAME.ID = DD_FPRODUCT.FPRODUCT_NAME UNION ALL SELECT ? AS isBegin, t2.FUTURES_VARIETY_ID AS varietyId, t2.* FROM WB_TBL_FUT_TRANSACTION_BEGIN t2 ) FUT_TRANSACTION LEFT OUTER JOIN WB_TBL_FUT_TRANSACTION FUT_TRANSACTION_CORRECT ON FUT_TRANSACTION_CORRECT.I
D = FUT_TRANSACTION.FUT_TRANSACTION_ID AND FUT_TRANSACTION_CORRECT.DELETE_FLAG = '0' LEFT OUTER JOIN ST_TBL_SYS_ORGAN SYS_ORGAN ON SYS_ORGAN.ID = FUT_TRANSACTION.HEADER_ID LEFT OUTER JOIN ST_TBL_DD_FCOMPANY DD_FCOMPANY ON DD_FCOMPANY.ID = FUT_TRANSACTION.BROKER_ID LEFT OUTER JOIN ST_TBL_DD_ACCOUNT DD_ACCOUNT ON DD_ACCOUNT.ID = FUT_TRANSACTION.TRADING_ACCOUNT_ID LEFT OUTER JOIN ST_TBL_DD_EXCHANGE DD_MARKET ON DD_MARKET.id = FUT_TRANSACTION.MARKET_ID /*LEFT OUTER JOIN ST_TBL_DD_FPRODUCT DD_FPRODUCT ON DD_FPRODUCT.ID = FUT_TRANSACTION.FUTURES_VARIETY_ID*/ LEFT OUTER JOIN WB_TBL_FUT_CATEGORY FUT_CATEGORY ON FUT_CATEGORY.ID = FUT_TRANSACTION.CATEGORY_ID LEFT OUTER JOIN WB_TBL_FUT_SETTLE FUT_SETTLE ON FUT_SETTLE.ID = FUT_TRANSACTION.BILLING_ID /* LEFT JOIN ST_TBL_DD_FPRODUCT_NAME FPRODUCT_NAME ON FPRODUCT_NAME.ID = DD_FPRODUCT.FPRODUCT_NAME*/ LEFT JOIN ST_TBL_DD_FPRODUCT_NAME FPRODUCT_NAME ON FPRODUCT_NAME.ID = FUT_TRANSACTION.varietyId LEFT OUTER JOIN ST_TBL_FLE_ATTACHMENT ATTACHMENT ON ATT
ACHMENT.BUSINESS_DATA_ID = FUT_SETTLE.ID AND ATTACHMENT.DELETE_FLAG = '0' AND ATTACHMENT.ATTACHMENT_TYPE = 'WB_FUT_FutSettle' LEFT JOIN WB_VIEW_USER_STAFF NOTIFIER_STAFF ON NOTIFIER_STAFF.ACCOUNT = FUT_TRANSACTION. NOTIFIER LEFT JOIN ( SELECT FUT_PRICE_JOIN.FUTURES_DEAL_ID, CT_CONTRACT.CONTRACT_NO FROM WB_TBL_FUT_PRICE_JOIN FUT_PRICE_JOIN LEFT JOIN WB_TBL_FUT_PRICE FUT_PRICE ON FUT_PRICE.id = FUT_PRICE_JOIN.POINT_ID AND FUT_PRICE.DELETE_FLAG = '0' LEFT JOIN WB_TBL_CT_CONTRACT CT_CONTRACT ON CT_CONTRACT.id = FUT_PRICE.CONTRACT_ID AND CT_CONTRACT.DELETE_FLAG = '0' WHERE FUT_PRICE_JOIN.DELETE_FLAG = '0' ) t ON t.FUTURES_DEAL_ID = FUT_TRANSACTION.id LEFT JOIN ( SELECT DD_DICT_ITEM.DICT_ITEM_CODE, DD_DICT_ITEM.DICT_ITEM_NAME FROM ST_TBL_DD_DICT_CATEGORY DD_DICT_CATEGORY LEFT JOIN ST_TBL_DD_DICT_ITEM DD_DICT_ITEM ON DD_DICT_ITEM.DICT_CATEGORY_ID = DD_DICT_CATEGORY.id WHERE DD_DICT_CATEGORY.CATEGORY_LANGUAGE_CODE = 'FUT_TRANSACTION_CORRECT_STATUS' ) STATUS_DICT ON STATUS_DICT.DICT_ITEM_CODE =
 FUT_TRANSACTION.STATUS LEFT JOIN ( SELECT DD_DICT_ITEM.DICT_ITEM_CODE, DD_DICT_ITEM.DICT_ITEM_NAME FROM ST_TBL_DD_DICT_CATEGORY DD_DICT_CATEGORY LEFT JOIN ST_TBL_DD_DICT_ITEM DD_DICT_ITEM ON DD_DICT_ITEM.DICT_CATEGORY_ID = DD_DICT_CATEGORY.id WHERE DD_DICT_CATEGORY.CATEGORY_LANGUAGE_CODE = 'CATEGORY' ) CATEGORY_DICT ON CATEGORY_DICT.DICT_ITEM_CODE = FUT_TRANSACTION.CATEGORY LEFT JOIN ( SELECT DD_DICT_ITEM.DICT_ITEM_CODE, DD_DICT_ITEM.DICT_ITEM_NAME FROM ST_TBL_DD_DICT_CATEGORY DD_DICT_CATEGORY LEFT JOIN ST_TBL_DD_DICT_ITEM DD_DICT_ITEM ON DD_DICT_ITEM.DICT_CATEGORY_ID = DD_DICT_CATEGORY.id WHERE DD_DICT_CATEGORY.CATEGORY_LANGUAGE_CODE = 'CHECK_STATUS' ) CHECK_STATUS_DICT ON CHECK_STATUS_DICT.DICT_ITEM_CODE = FUT_TRANSACTION.CHECK_STATUS LEFT JOIN ( SELECT DD_DICT_ITEM.DICT_ITEM_CODE, DD_DICT_ITEM.DICT_ITEM_NAME FROM ST_TBL_DD_DICT_CATEGORY DD_DICT_CATEGORY LEFT JOIN ST_TBL_DD_DICT_ITEM DD_DICT_ITEM ON DD_DICT_ITEM.DICT_CATEGORY_ID = DD_DICT_CATEGORY.id WHERE DD_DICT_CATEGORY.CATEGORY_
LANGUAGE_CODE = 'YES_NO' ) BEGIN_DICT ON BEGIN_DICT.DICT_ITEM_CODE = FUT_TRANSACTION.isBegin LEFT JOIN ( SELECT DD_DICT_ITEM.DICT_ITEM_CODE, DD_DICT_ITEM.DICT_ITEM_NAME FROM ST_TBL_DD_DICT_CATEGORY DD_DICT_CATEGORY LEFT JOIN ST_TBL_DD_DICT_ITEM DD_DICT_ITEM ON DD_DICT_ITEM.DICT_CATEGORY_ID = DD_DICT_CATEGORY.id WHERE DD_DICT_CATEGORY.CATEGORY_LANGUAGE_CODE = 'TRANSACTION_TYPE' ) TRANSACTION_TYPE_DICT ON TRANSACTION_TYPE_DICT.DICT_ITEM_CODE = FUT_TRANSACTION.TRANSACTION_TYPE LEFT JOIN ( SELECT DD_DICT_ITEM.DICT_ITEM_CODE, DD_DICT_ITEM.DICT_ITEM_NAME FROM ST_TBL_DD_DICT_CATEGORY DD_DICT_CATEGORY LEFT JOIN ST_TBL_DD_DICT_ITEM DD_DICT_ITEM ON DD_DICT_ITEM.DICT_CATEGORY_ID = DD_DICT_CATEGORY.id WHERE DD_DICT_CATEGORY.CATEGORY_LANGUAGE_CODE = 'OPTION_DIRECTION' ) OPTION_DIRECTION_DICT ON OPTION_DIRECTION_DICT.DICT_ITEM_CODE = FUT_TRANSACTION.FUTURES_DIRECTION LEFT JOIN ( SELECT DD_DICT_ITEM.DICT_ITEM_CODE, DD_DICT_ITEM.DICT_ITEM_NAME FROM ST_TBL_DD_DICT_CATEGORY DD_DICT_CATEGORY LEFT JOIN ST
_TBL_DD_DICT_ITEM DD_DICT_ITEM ON DD_DICT_ITEM.DICT_CATEGORY_ID = DD_DICT_CATEGORY.id WHERE DD_DICT_CATEGORY.CATEGORY_LANGUAGE_CODE = 'FUTURES_POSITIONS' ) FUTURES_POSITIONS_DICT ON FUTURES_POSITIONS_DICT.DICT_ITEM_CODE = FUT_TRANSACTION.FUTURES_POSITIONS left join WB_TBL_FUT_DAILY_TRANSACTION FUT_DAILY_TRANSACTION on FUT_DAILY_TRANSACTION .TRANSACTION_ID = FUT_TRANSACTION.id and FUT_DAILY_TRANSACTION.DELETE_FLAG = '0' and FUT_DAILY_TRANSACTION.EFFECT_STATUS = '0' left join WB_TBL_FUT_DAILY DAILY on DAILY.id = FUT_DAILY_TRANSACTION.DAILY_ID and DAILY.DELETE_FLAG = '0' LEFT JOIN WB_TBL_DD_APPROVAL_BUSINESS DD_APPROVAL_BUSINESS ON DD_APPROVAL_BUSINESS.BUSINESS_ID = DAILY.ID AND DD_APPROVAL_BUSINESS.DELETE_FLAG = '0' AND DD_APPROVAL_BUSINESS.BUSINESS_TYPE = 'FUT_DAILY' LEFT JOIN ( SELECT DD_DICT_ITEM.DICT_ITEM_CODE, DD_DICT_ITEM.DICT_ITEM_NAME FROM ST_TBL_DD_DICT_CATEGORY DD_DICT_CATEGORY LEFT JOIN ST_TBL_DD_DICT_ITEM DD_DICT_ITEM ON DD_DICT_ITEM.DICT_CATEGORY_ID = DD_DICT_CATEGORY.id WHE
RE DD_DICT_CATEGORY.CATEGORY_LANGUAGE_CODE = 'FUT_STATUS' ) APPROVAL_STATUS_DICT ON APPROVAL_STATUS_DICT.DICT_ITEM_CODE = FUT_TRANSACTION.APPROVAL_STATUS WHERE FUT_TRANSACTION.DELETE_FLAG = '0' group by FUT_TRANSACTION.IS_CONFIRM_FLAG, FUT_TRANSACTION.NOTIFIER, NOTIFIER_STAFF.STAFF_NAME, FUT_TRANSACTION.APPROVAL_STATUS, DD_APPROVAL_BUSINESS.APPROVAL_GROUP , APPROVAL_STATUS_DICT.DICT_ITEM_NAME, BEGIN_DICT.DICT_ITEM_NAME, TRANSACTION_TYPE_DICT.DICT_ITEM_NAME, OPTION_DIRECTION_DICT.DICT_ITEM_NAME, FUTURES_POSITIONS_DICT.DICT_ITEM_NAME, FUT_TRANSACTION.CATEGORY, CATEGORY_DICT.DICT_ITEM_NAME, FUT_TRANSACTION. CHECK_STATUS, FUT_TRANSACTION. CHECK_STAFF, CHECK_STATUS_DICT.DICT_ITEM_NAME, FUT_TRANSACTION. FUT_TRANSACTION_ID, ATTACHMENT.ID, FUT_SETTLE.BILLING_DOCUMENT_PATH, FUT_TRANSACTION. PROCEDURE_FEE_AMT, FUT_TRANSACTION. isBegin, FUT_TRANSACTION. ID, FUT_TRANSACTION.HEADER_ID, FUT_TRANSACTION.TRANSACTION_TYPE, FUT_TRANSACTION.BROKER_ID, FUT_TRANSACTION.TRADING_ACCOUNT_ID, FUT_TRANSACTION.M
ARKET_ID, FUT_TRANSACTION.FUTURES_VARIETY_ID, FUT_TRANSACTION.FUTURES_CONTRACT, FUT_TRANSACTION.DEAL_DATE, TO_CHAR(FUT_TRANSACTION.DEAL_DATE,'YYYY-MM-DD'), FUT_TRANSACTION.FUTURES_DIRECTION, FUT_TRANSACTION.FUTURES_POSITIONS, FUT_TRANSACTION.STRIKE_PRI, FUT_TRANSACTION.CURRENCY, FUT_TRANSACTION.STRIKE_LOT, FUT_TRANSACTION.STRIKE_WEIGHT, FUT_TRANSACTION.UNIT, FUT_TRANSACTION.USED_STRIKE_LOTS, FUT_TRANSACTION.AVAILABLE_STRIKE_LOTS, FUT_TRANSACTION.CATEGORY_ID, FUT_TRANSACTION.STRIKE_NO, FUT_TRANSACTION.BILLING_ID, FUT_TRANSACTION.STATUS, STATUS_DICT.DICT_ITEM_NAME, FUT_TRANSACTION.REMARK, FUT_TRANSACTION.DELETE_FLAG, FUT_TRANSACTION.VERSION_NUM, FUT_TRANSACTION.CREATE_USER, FUT_TRANSACTION.CREATE_DATE, FUT_TRANSACTION.UPDATE_USER, FUT_TRANSACTION.UPDATE_DATE, FUT_TRANSACTION.LIABLE_MAN, NVL ( FUT_TRANSACTION.QUANTITY,0), /*关联ID*/ FUT_TRANSACTION.TRANSACTION_ID, SYS_ORGAN.ORGAN_NAME, DD_FCOMPANY.FCOMPANY_ALL_NAME, DD_ACCOUNT.USER_ACCOUNT, FPRODUCT_NAME.FPRODUCT_NAME, /*FUT_CATEGORY.CATEGO
RY_NAME,*/ DD_MARKET.EXCHANGE_CODE , FUT_TRANSACTION_CORRECT.STRIKE_NO order by FUT_TRANSACTION.DEAL_DATE desc ) select wran.* from temp wran where 1 = 1 /*期货头寸预警*/ and wran.APPROVAL_STATUS = '2' and wran.LIABLE_MAN IS NOT NULL AND wran.contractNo IS NULL AND TO_CHAR(wran.DEAL_DATE, 'YYYY-MM-DD') >= '2020-01-01' /*复核预警*/ ) where 1 = 1 ) TMP WHERE ROWNUM <=20) WHERE ROW_ID > 0 
2020-01-13 22:50:26.638 DEBUG 16444 --- [nio-8080-exec-5] n.q.p.w.f.m.F.listFutTransaction         : ==> Parameters: 0(String), 1(String)
2020-01-13 22:50:26.665 DEBUG 16444 --- [nio-8080-exec-5] n.q.p.w.f.m.F.listFutTransaction         : <==      Total: 1